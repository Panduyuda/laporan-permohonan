<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Laporan DLH Sukoharjo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f0fdf4;
    }
    .hijau-gelap {
      background-color: #1a5632;
    }
    .hijau-terang {
      background-color: #2e8540;
    }
    .border-hijau {
      border-color: #1a5632;
    }
    .btn-hijau {
      background: linear-gradient(to bottom, #2e8540, #1a5632);
    }
    .card-shadow {
      box-shadow: 0 4px 6px rgba(0, 100, 0, 0.1);
    }
    .logo-kiri {
      position: absolute;
      left: 20px;
      top: 10px;
    }
    .logo-kanan {
      position: absolute;
      right: 20px;
      top: 10px;
    }
    .header-content {
      position: relative;
      padding-top: 100px;
    }
    .title-main {
      font-size: 2.5rem;
      line-height: 1.2;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }
    .title-sub {
      font-size: 1.8rem;
      line-height: 1.3;
    }
    .title-system {
      font-size: 1.5rem;
      letter-spacing: 1px;
    }
  </style>
</head>
<body>
  <!-- Header with Corner Logos -->
  <div class="hijau-gelap py-4 text-white relative min-h-[180px]">
    <!-- Logo Kabupaten (Pojok Kiri) -->
    <div class="logo-kiri">
      <img src="logo/PEMKAB-SUKOHARJO-01.png" alt="Logo Kabupaten" class="h-[150px] max-w-[150px] w-auto">
    </div>
    
    <!-- Logo Bidang (Pojok Kanan) -->
    <div class="logo-kanan">
      <img src="logo/Logo-01.png" alt="Logo Bidang" class="h-[150px] max-w-[150px] w-auto"">
    </div>
    
    <!-- Judul Tengah -->
    <div class="header-content text-center mx-auto pt-2">
      <h1 class="title-main font-bold mb-2">DINAS LINGKUNGAN HIDUP</h1>
      <h2 class="title-sub font-semibold mb-3">KABUPATEN SUKOHARJO</h2>
      <p class="title-system font-medium italic">Sistem Laporan Permohonan Bantuan</p>
    </div>
  </div>
  <div class="container mx-auto p-4 md:p-6">
    <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
      <div class="bg-green-600 px-6 py-3">
        <h2 class="text-xl font-bold text-white">Laporan Permohonan Bantuan</h2>
      </div>
      
      <!-- Form Input -->
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="tanggal" class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
            <input type="date" id="tanggal" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" />
          </div>
          <div>
            <label for="noSurat" class="block text-sm font-medium text-gray-700 mb-1">Nomor Surat</label>
            <input type="text" id="noSurat" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="Masukkan nomor surat" />
          </div>
          <div>
            <label for="pemohon" class="block text-sm font-medium text-gray-700 mb-1">Nama Pemohon/Instansi</label>
            <input type="text" id="pemohon" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="Nama lengkap pemohon" />
          </div>
          <div>
            <label for="alamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat</label>
            <input type="text" id="alamat" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="Alamat lengkap" />
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">Keterangan Permohonan</label>
            <div id="barangContainer">
              <!-- Barang akan ditambahkan dinamis di sini -->
            </div>
            <button type="button" onclick="tambahBarang()" class="mt-2 text-sm text-green-600 hover:text-green-800 flex items-center">
              <i class="fas fa-plus-circle mr-1"></i> Tambah Barang
            </button>
          </div>
          <div>
            <label for="realisasi" class="block text-sm font-medium text-gray-700 mb-1">Status Realisasi</label>
            <select id="realisasi" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
              <option value="">Pilih status realisasi</option>
              <option value="Sudah">Sudah Direalisasi</option>
              <option value="Belum">Belum Direalisasi</option>
              <option value="TL">Tindak Lanjut</option>
            </select>
          </div>
        </div>
        <div class="mt-6 flex justify-end">
          <button onclick="submitData()" class="btn-primary text-white px-6 py-2 rounded-lg font-medium flex items-center">
            <i class="fas fa-paper-plane mr-2"></i> Kirim Permohonan
          </button>
        </div>
      </div>
    </div>

    <!-- Template untuk input barang (hidden) -->
    <template id="barangTemplate">
      <div class="grid grid-cols-2 gap-4 mb-3 barang-item">
        <div>
          <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 jenis-barang">
            <option value="">Pilih Jenis Barang</option>
            <option value="Komposter">Komposter</option>
            <option value="Tempat Sampah Pilah">Tempat Sampah Pilah</option>
            <option value="Gerobak Sampah">Gerobak Sampah</option>
            <option value="Mesin Pencacah">Mesin Pencacah</option>
            <option value="Motor Roda 3">Motor Roda 3</option>
            <option value="Lainnya">Lainnya</option>
          </select>
        </div>
        <div class="flex items-center">
          <input type="number" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 jumlah-barang" placeholder="Jumlah">
          <button type="button" onclick="hapusBarang(this)" class="ml-2 text-red-500 hover:text-red-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="col-span-2 catatan-lainnya-container hidden">
          <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 catatan-lainnya" placeholder="Sebutkan jenis barang">
        </div>
      </div>
    </template>

    <!-- Statistik -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 my-8">
      <div class="stat-card bg-white rounded-xl shadow-md overflow-hidden border-l-4 border-green-500">
        <div class="p-6">
          <div class="flex items-center">
            <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
              <i class="fas fa-file-alt text-lg"></i>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Total Permohonan</h3>
              <p class="text-2xl font-bold text-gray-900" id="totalData">0</p>
            </div>
          </div>
        </div>
      </div>
      <div class="stat-card bg-white rounded-xl shadow-md overflow-hidden border-l-4 border-blue-500">
        <div class="p-6">
          <div class="flex items-center">
            <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
              <i class="fas fa-check-circle text-lg"></i>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Sudah Direalisasi</h3>
              <p class="text-2xl font-bold text-gray-900" id="sudahData">0</p>
            </div>
          </div>
        </div>
      </div>
      <div class="stat-card bg-white rounded-xl shadow-md overflow-hidden border-l-4 border-yellow-500">
        <div class="p-6">
          <div class="flex items-center">
            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
              <i class="fas fa-clock text-lg"></i>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Belum/TL</h3>
              <p class="text-2xl font-bold text-gray-900" id="belumData">0</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Boxes -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- Edukasi -->
      <div class="bg-white rounded-lg shadow-md">
  <div class="border-b border-gray-200 px-6 py-4">
    <h2 class="text-xl font-semibold text-gray-800">
      <i class="fas fa-tools mr-2"></i> Tips Pengelolaan Sarana Prasarana
    </h2>
  </div>
  <div class="p-6">
    <ul class="space-y-3">
      <li class="flex items-start">
        <i class="fas fa-calendar-check text-blue-500 mt-1 mr-3"></i>
        <span>Lakukan pemeliharaan rutin pada sarana dan prasarana yang ada</span>
      </li>
      <li class="flex items-start">
        <i class="fas fa-bolt text-blue-500 mt-1 mr-3"></i>
        <span>Optimalkan penggunaan fasilitas untuk efisiensi energi dan sumber daya</span>
      </li>
      <li class="flex items-start">
        <i class="fas fa-microchip text-blue-500 mt-1 mr-3"></i>
        <span>Manfaatkan teknologi terkini untuk meningkatkan kinerja sarana prasarana</span>
      </li>
      <li class="flex items-start">
        <i class="fas fa-clipboard-list text-blue-500 mt-1 mr-3"></i>
        <span>Lakukan inventarisasi berkala untuk mencatat kondisi aset</span>
      </li>
      <li class="flex items-start">
        <i class="fas fa-exclamation-triangle text-blue-500 mt-1 mr-3"></i>
        <span>Sediakan sistem pelaporan kerusakan untuk perbaikan cepat</span>
      </li>
    </ul>
  </div>
</div>

      <!-- Kontak -->
      <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <div class="bg-green-600 px-6 py-3">
          <h2 class="text-xl font-bold text-white flex items-center">
            <i class="fas fa-address-card mr-2"></i> Kontak Kami
          </h2>
        </div>
        <div class="p-6">
          <div class="flex items-start mb-4">
            <i class="fas fa-map-marker-alt text-green-500 mt-1 mr-4 text-lg"></i>
            <div>
              <h3 class="font-semibold text-gray-800">Alamat Kantor</h3>
              <p class="text-gray-600">Jl. Jend. Sudirman No.199, Sukoharjo, Jawa Tengah</p>
            </div>
          </div>
          <div class="flex items-start mb-4">
            <i class="fas fa-phone-alt text-green-500 mt-1 mr-4 text-lg"></i>
            <div>
              <h3 class="font-semibold text-gray-800">Telepon</h3>
              <p class="text-gray-600">(0271) 593067</p>
            </div>
          </div>
          <div class="flex items-start mb-4">
            <i class="fas fa-envelope text-green-500 mt-1 mr-4 text-lg"></i>
            <div>
              <h3 class="font-semibold text-gray-800">Email</h3>
              <p class="text-gray-600">dlh@sukoharjokab.go.id</p>
            </div>
          </div>
          <div class="flex items-start">
            <i class="fas fa-clock text-green-500 mt-1 mr-4 text-lg"></i>
            <div>
              <h3 class="font-semibold text-gray-800">Jam Operasional</h3>
              <p class="text-gray-600">Senin-Kamis: 07.00-15.30 WIB</p>
              <p class="text-gray-600">Jumat      : 07.00-14.00 WIB</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabel Data -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
      <div class="bg-green-600 px-6 py-3">
        <h2 class="text-xl font-bold text-white flex items-center">
          <i class="fas fa-table mr-2"></i> Data Permohonan Bantuan
        </h2>
      </div>
      <div class="p-6">
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No Surat</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pemohon</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Alamat</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Realisasi</th>
              </tr>
            </thead>
            <tbody id="dataTable" class="bg-white divide-y divide-gray-200">
              <!-- Data will be inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-6">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <p class="text-sm">Â© 2023 Dinas Lingkungan Hidup Kabupaten Sukoharjo</p>
          <p class="text-xs text-gray-400">Sistem Laporan Permohonan Bantuan Bank Sampah</p>
        </div>
        <div class="flex space-x-4">
          <a href="#" class="text-gray-300 hover:text-white">
            <i class="fab fa-facebook-f"></i>
          </a>
          <a href="#" class="text-gray-300 hover:text-white">
            <i class="fab fa-twitter"></i>
          </a>
          <a href="#" class="text-gray-300 hover:text-white">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="#" class="text-gray-300 hover:text-white">
            <i class="fab fa-youtube"></i>
          </a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Script -->
  <script>
    const url = "https://script.google.com/macros/s/AKfycbwZp5KxhG0vJOMz9owg-U_3kDBah9r-PqlYhKs8CHTh0UdB0duiAEJSxMUwACzI0aW7/exec";

    // Fungsi untuk menambah input barang
    function tambahBarang() {
      const template = document.getElementById('barangTemplate');
      const clone = template.content.cloneNode(true);
      document.getElementById('barangContainer').appendChild(clone);
      
      // Set event listener untuk select jenis barang
      const selectBarang = document.querySelector('#barangContainer .barang-item:last-child .jenis-barang');
      selectBarang.addEventListener('change', function() {
        const container = this.closest('.barang-item').querySelector('.catatan-lainnya-container');
        if (this.value === 'Lainnya') {
          container.classList.remove('hidden');
        } else {
          container.classList.add('hidden');
        }
      });
    }

    // Fungsi untuk menghapus input barang
    function hapusBarang(button) {
      button.closest('.barang-item').remove();
    }

    // Panggil fungsi tambahBarang() saat halaman dimuat untuk menampilkan satu input default
    document.addEventListener('DOMContentLoaded', function() {
      tambahBarang();
    });

    function submitData() {
      const tanggal = document.getElementById("tanggal");
      const noSurat = document.getElementById("noSurat");
      const pemohon = document.getElementById("pemohon");
      const alamat = document.getElementById("alamat");
      
      // Simple validation
      if (!tanggal.value || !noSurat.value || !pemohon.value || !alamat.value) {
        alert("Harap lengkapi semua data permohonan!");
        return;
      }

      // Kumpulkan data barang
      const barangItems = document.querySelectorAll('.barang-item');
      const barangData = [];
      
      barangItems.forEach(item => {
        const jenis = item.querySelector('.jenis-barang').value;
        const jumlah = item.querySelector('.jumlah-barang').value;
        
        if (!jenis || !jumlah) {
          alert("Harap lengkapi semua data barang!");
          throw new Error("Data barang tidak lengkap");
        }
        
        let keteranganBarang = jenis;
        if (jenis === 'Lainnya') {
          const catatan = item.querySelector('.catatan-lainnya').value;
          if (!catatan) {
            alert("Harap isi keterangan untuk barang 'Lainnya'!");
            throw new Error("Catatan barang lainnya kosong");
          }
          keteranganBarang = catatan;
        }
        
        barangData.push({
          jenis: keteranganBarang,
          jumlah: parseInt(jumlah)
        });
      });

      const data = {
        tanggal: tanggal.value,
        noSurat: noSurat.value,
        pemohon: pemohon.value,
        alamat: alamat.value,
        barang: JSON.stringify(barangData),
        keterangan: barangData.map(b => `${b.jenis} (${b.jumlah} buah)`).join(", "),
        realisasi: document.getElementById("realisasi").value,
      };

      // Show loading state
      const button = document.querySelector('button[onclick="submitData()"]');
      button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Mengirim...';
      button.disabled = true;

      fetch(url, {
        method: "POST",
        body: JSON.stringify(data),
      })
      .then(res => res.text())
      .then(() => {
        alert("Data berhasil dikirim!");
        location.reload();
      })
      .catch(() => {
        alert("Terjadi kesalahan saat mengirim data.");
        button.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Kirim Permohonan';
        button.disabled = false;
      });
    }

    // Format date to local Indonesian format
    function formatDate(dateString) {
      if (!dateString) return '-';
      const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
      return new Date(dateString).toLocaleDateString('id-ID', options);
    }

    // Get status badge
    function getStatusBadge(status) {
      if (!status) return '<span class="px-2 py-1 text-xs rounded">-</span>';
      const lowerStatus = status.toLowerCase();
      if (lowerStatus === 'sudah') {
        return '<span class="px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800">Sudah</span>';
      } else if (lowerStatus === 'belum') {
        return '<span class="px-2 py-1 text-xs font-semibold rounded bg-yellow-100 text-yellow-800">Belum</span>';
      } else if (lowerStatus === 'tl') {
        return '<span class="px-2 py-1 text-xs font-semibold rounded bg-red-100 text-red-800">TL</span>';
      }
      return status;
    }

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const table = document.getElementById("dataTable");
        let total = 0, sudah = 0, belum = 0;

        // Clear existing data
        table.innerHTML = '';

        if (data.length === 0) {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td colspan="6" class="px-6 py-4 text-center text-gray-500">
              Belum ada data permohonan
            </td>
          `;
          table.appendChild(row);
        } else {
          data.forEach(item => {
            const row = document.createElement("tr");
            row.className = "hover:bg-gray-50";
            row.innerHTML = `
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(item.tanggal)}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.noSurat || '-'}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.pemohon || '-'}</td>
              <td class="px-6 py-4 text-sm text-gray-500">${item.alamat || '-'}</td>
              <td class="px-6 py-4 text-sm text-gray-500">
                ${item.keterangan || '-'}
                ${item.barang ? '<div class="text-xs text-gray-400 mt-1">' + 
                   JSON.parse(item.barang).map(b => `${b.jenis}: ${b.jumlah}`).join(', ') + 
                   '</div>' : ''}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                ${getStatusBadge(item.realisasi)}
              </td>
            `;
            table.appendChild(row);
            total++;
            if (item.realisasi && item.realisasi.toLowerCase() === "sudah") sudah++;
            else belum++;
          });
        }

        document.getElementById("totalData").textContent = total;
        document.getElementById("sudahData").textContent = sudah;
        document.getElementById("belumData").textContent = belum;
      })
      .catch(error => {
        console.error("Error fetching data:", error);
        const table = document.getElementById("dataTable");
        table.innerHTML = `
          <tr>
            <td colspan="6" class="px-6 py-4 text-center text-red-500">
              Gagal memuat data. Silakan coba lagi nanti.
            </td>
          </tr>
        `;
      });
  </script>
</body>
</html>
